<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Shop - Telegram Order</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@100;400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Kantumruy Pro', sans-serif; }
        .cart-drawer { transition: transform 0.3s ease-in-out; }
        .hidden-drawer { transform: translateY(100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-xl relative pb-20">
        <!-- Header -->
        <nav class="bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-20 border-b">
            <h1 class="font-black text-xl text-blue-600 flex items-center gap-2 italic uppercase">
                <i data-lucide="package" class="text-blue-500"></i> Online Shop
            </h1>
            <button onclick="toggleCart(true)" class="relative p-2 bg-slate-100 rounded-full active:scale-90 transition-transform">
                <i data-lucide="shopping-cart" class="text-blue-600"></i>
                <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 rounded-full hidden flex items-center justify-center font-bold border-2 border-white">0</span>
            </button>
        </nav>

        <!-- Product List -->
        <div id="product-list" class="p-4 grid grid-cols-2 gap-4">
            <!-- Products will be injected here -->
        </div>

        <!-- Cart Drawer -->
        <div id="cart-overlay" onclick="toggleCart(false)" class="fixed inset-0 bg-black/60 z-30 hidden opacity-0 transition-opacity duration-300"></div>
        <div id="cart-drawer" class="fixed inset-x-0 bottom-0 bg-white z-40 rounded-t-[2.5rem] p-6 max-h-[90vh] overflow-y-auto cart-drawer hidden-drawer shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-black text-xl flex items-center gap-2">
                    <i data-lucide="shopping-cart" class="text-blue-600"></i> á€á“áŸ’ááŸ’ášá€á¢á¸áœáŸ‰á¶á“áŸ‹
                </h2>
                <button onclick="toggleCart(false)" class="p-2 bg-slate-100 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div id="cart-items" class="space-y-4 mb-6">
                <!-- Cart items will be injected here -->
            </div>

            <div id="cart-footer" class="hidden space-y-4 border-t border-dashed pt-4">
                <!-- Customer Info -->
                <div class="space-y-2">
                    <p class="text-xs font-black text-slate-500 uppercase ml-1">á–áŸááŸŒá˜á¶á“áŠá¹á€á‡á‰áŸ’á‡á¼á“</p>
                    <input id="cust-name" type="text" placeholder="áˆáŸ’á˜áŸ„áŸ‡ášá”áŸáŸ‹á¢áŸ’á“á€" class="w-full p-3 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-300">
                    <input id="cust-phone" type="text" placeholder="á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘" class="w-full p-3 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-300">
                    <input id="cust-address" type="text" placeholder="á¢á¶áŸá™áŠáŸ’á‹á¶á“áŠá¹á€á‡á‰áŸ’á‡á¼á“" class="w-full p-3 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-300">
                </div>

                <!-- ABA QR -->
                <div class="p-5 bg-gradient-to-b from-blue-600 to-blue-800 rounded-[2.5rem] text-center">
                    <p class="text-xs font-black text-white uppercase tracking-widest mb-3">Scan to Pay (ABA)</p>
                    <img id="aba-qr" src="" class="mx-auto w-40 h-40 rounded-2xl bg-white p-2 shadow-lg mb-3" alt="ABA QR">
                    <div class="bg-white/10 rounded-xl py-2 px-4 inline-block border border-white/20">
                        <p id="total-price" class="text-white text-sm font-black italic">áŸášá»á”: $0</p>
                    </div>
                </div>

                <button onclick="handleOrder()" id="btn-order" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black shadow-lg active:scale-95 transition-all text-lg">
                    á”á‰áŸ’á‡á¶á€áŸ‹á€á¶ášá€á˜áŸ’á˜áŸ‰á„áŸ‹
                </button>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="fixed inset-0 bg-blue-600 z-[100] hidden flex flex-col items-center justify-center text-white p-8 text-center">
            <i data-lucide="check-circle" class="w-20 h-20 mb-6"></i>
            <h2 class="text-3xl font-black mb-3">á€á¶ášá€á˜áŸ’á˜áŸ‰á„áŸ‹á‡áŸ„á‚á‡áŸá™!</h2>
            <p class="opacity-90">á–áŸááŸŒá˜á¶á“á€á˜áŸ’á˜áŸ‰á„áŸ‹ááŸ’ášá¼áœá”á¶á“á•áŸ’á‰á¾á‘áŸ…á€á¶á“áŸ‹á¢áŸ’á“á€á›á€áŸ‹ášá½á…ášá¶á›áŸ‹áŸ”</p>
            <button onclick="location.reload()" class="mt-8 px-6 py-2 bg-white text-blue-600 rounded-full font-bold">á”á“áŸ’áá‘á·á‰á‘áŸ€á</button>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const BOT_TOKEN = "8313263576:AAEqP3T5ycuQP0bi6k0NTmJYbeVyBJCGBbY";
        const CHAT_ID = "1859589466";
        const ABA_PAY_LINK = "https://pay.ababank.com/oRF8/14ye9kc4";
        const MY_QR_IMAGE = "https://image2url.com/r2/default/images/1768742261606-baa1aec3-fa27-47ec-abd8-2b72d1d4aca4.jpg";

        const PRODUCTS = [
            { id: 1, name: "á¢á¶áœá™áºááŠáŸƒááŸ’á›á¸ Premium Cotton", price: 12, image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400" },
            { id: 2, name: "áŸáŸ’á”áŸ‚á€á‡á¾á„á”áŸ‰á¶ááŸ‹áá¶ Sport Pro", price: 45, image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400" },
            { id: 3, name: "á“á¶á¡á·á€á¶áŠáŸƒ Smart Watch", price: 85, image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400" },
            { id: 4, name: "á€á¶á”á¼á”áŸáŸ’á–á¶á™á…áŸ†á áŸ€á„", price: 25, image: "https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=400" },
        ];

        let cart = [];

        // Initialize Products
        const productList = document.getElementById('product-list');
        PRODUCTS.forEach(p => {
            const div = document.createElement('div');
            div.className = "bg-white rounded-3xl shadow-sm border overflow-hidden flex flex-col";
            div.innerHTML = `
                <img src="${p.image}" class="w-full aspect-square object-cover">
                <div class="p-3 flex flex-col flex-grow">
                    <h3 class="font-bold text-sm h-10 line-clamp-2">${p.name}</h3>
                    <div class="flex justify-between items-center mt-auto pt-3">
                        <span class="text-blue-600 font-black text-lg">$${p.price}</span>
                        <button onclick="addToCart(${p.id})" class="bg-blue-600 text-white p-2 rounded-xl active:scale-90 transition-transform">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `;
            productList.appendChild(div);
        });

        lucide.createIcons();

        function toggleCart(show) {
            const drawer = document.getElementById('cart-drawer');
            const overlay = document.getElementById('cart-overlay');
            if (show) {
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.add('opacity-100'), 10);
                drawer.classList.remove('hidden-drawer');
                renderCart();
            } else {
                overlay.classList.remove('opacity-100');
                drawer.classList.add('hidden-drawer');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }

        function addToCart(id) {
            const product = PRODUCTS.find(p => p.id === id);
            const exist = cart.find(i => i.id === id);
            if (exist) {
                exist.qty++;
            } else {
                cart.push({...product, qty: 1});
            }
            updateCartUI();
        }

        function updateQty(id, delta) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.qty += delta;
                if (item.qty < 1) cart = cart.filter(i => i.id !== id);
            }
            renderCart();
            updateCartUI();
        }

        function updateCartUI() {
            const count = cart.reduce((a, b) => a + b.qty, 0);
            const badge = document.getElementById('cart-count');
            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const footer = document.getElementById('cart-footer');
            const totalDisplay = document.getElementById('total-price');
            const qrImg = document.getElementById('aba-qr');

            if (cart.length === 0) {
                container.innerHTML = `<div class="text-center py-10 text-slate-400 italic">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á‘áŸ†á“á·á‰</div>`;
                footer.classList.add('hidden');
                return;
            }

            footer.classList.remove('hidden');
            container.innerHTML = cart.map(i => `
                <div class="flex gap-3 items-center bg-slate-50 p-3 rounded-2xl border">
                    <img src="${i.image}" class="w-12 h-12 rounded-xl object-cover">
                    <div class="flex-grow">
                        <h4 class="text-xs font-bold">${i.name}</h4>
                        <p class="text-blue-600 text-sm font-black">$${i.price * i.qty}</p>
                    </div>
                    <div class="flex items-center gap-2 bg-white rounded-lg p-1 shadow-sm">
                        <button onclick="updateQty(${i.id}, -1)" class="p-1"><i data-lucide="minus" class="w-3 h-3"></i></button>
                        <span class="text-xs font-black w-4 text-center">${i.qty}</span>
                        <button onclick="updateQty(${i.id}, 1)" class="p-1"><i data-lucide="plus" class="w-3 h-3"></i></button>
                    </div>
                </div>
            `).join('');

            const total = cart.reduce((a, b) => a + b.price * b.qty, 0);
            totalDisplay.innerText = `áŸášá»á”: $${total}`;
            
            // Set QR with fallback
            qrImg.src = MY_QR_IMAGE;
            qrImg.onerror = () => {
                qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(ABA_PAY_LINK)}`;
            };

            lucide.createIcons();
        }

        async function handleOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const address = document.getElementById('cust-address').value;

            if (!name || !phone) return alert("áŸá¼á˜á”áŸ†á–áŸá‰áˆáŸ’á˜áŸ„áŸ‡ á“á·á„á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘!");

            const btn = document.getElementById('btn-order');
            btn.innerText = "á€áŸ†á–á»á„á”á‰áŸ’á‡á¼á“...";
            btn.disabled = true;

            const itemsText = cart.map(i => `ğŸ›’ ${i.name} (${i.qty}x) = $${i.price * i.qty}`).join('\n');
            const total = cart.reduce((a, b) => a + b.price * b.qty, 0);
            const message = `ğŸ”” **á€á¶ášá€á˜áŸ’á˜áŸ‰á„áŸ‹ááŸ’á˜á¸**\nğŸ‘¤ áˆáŸ’á˜áŸ„áŸ‡: ${name}\nğŸ“ á›áŸá: ${phone}\nğŸ“ á‘á¸áá¶áŸ†á„: ${address || 'á˜á·á“á˜á¶á“'}\n\nğŸ“¦ á‘áŸ†á“á·á‰:\n${itemsText}\n\nğŸ’° áŸášá»á”: $${total}`;

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: CHAT_ID, text: message, parse_mode: 'Markdown' })
                });
                document.getElementById('success-modal').classList.remove('hidden');
            } catch (e) {
                alert("á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾!");
                btn.innerText = "á”á‰áŸ’á‡á¶á€áŸ‹á€á¶ášá€á˜áŸ’á˜áŸ‰á„áŸ‹";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>